<!doctype html>
<html lang=en xmlns:th="http://www.thymeleaf.org">

<header th:fragment="header(url)">
    <select name="agency" onchange="location.assign(this.value)" style="max-width: 250px">
        <option th:value="@{${url}(alias=${currentUser.userid})}">- Personal Worktray -</option>
        <option th:if="${ownerId != null && ownerId != currentUser.id}" th:value="@{${url}(alias=${alias})}" th:text="|${alias}'s Worktray|" selected>jsmith</option>
        <option th:each="agency: ${worktrayAgencies}" th:value="@{${url}(alias=${agency.organisation.alias})}" th:text="${agency.name}"
                th:selected="${agency.organisation.alias == alias}">
            My Agency
        </option>
    </select>
    <form th:action="@{/titles}">
        <input type=search name="q" placeholder="Search Titles" data-keybind="f">
    </form>
</header>

<div th:fragment="pagination(page)">
    <nav class="pagination" th:if="${page != null and page.totalPages > 1}" aria-label="Pagination"
         th:with="
             cur=${page.number},
             total=${page.totalPages},
             last=${total - 1},
             width=${10},
             mid=${width - 2},
             half=${mid / 2},
             start=${T(java.lang.Math).max(1, T(java.lang.Math).min(cur - half, last - mid))},
             end=${T(java.lang.Math).min(start + mid - 1, last - 1)}">
        <!-- Prev -->
        <a class="btn btn-compact" th:if="${page.hasPrevious()}" th:href="@{''(page=${cur - 1})}" rel="prev">〈 Prev</a>
        <span class="btn btn-compact disabled" th:unless="${page.hasPrevious()}">〈 Prev</span>

        <!-- First page -->
        <a class="btn btn-secondary" th:if="${cur != 0}" th:href="@{''(page=0)}">1</a>
        <span class="btn btn-secondary disabled" th:if="${cur == 0}" th:text="1" aria-current="page"></span>

        <!-- Leading ellipsis -->
        <span class="dots" th:if="${start > 1}">…</span>

        <!-- Window around current -->
        <span th:each="n : ${#numbers.sequence(start, end)}">
          <a class="btn btn-secondary" th:if="${n != cur}" th:text="${n + 1}" th:href="@{''(page=${n})}"></a>
          <span class="btn btn-secondary disabled" th:if="${n == cur}" th:text="${n + 1}" aria-current="page"></span>
        </span>

        <!-- Trailing ellipsis -->
        <span class="dots" th:if="${end < last - 1}">…</span>

        <!-- Last page -->
        <a class="btn btn-secondary" th:if="${cur != last}" th:text="${total}" th:href="@{''(page=${last})}"></a>
        <span class="btn btn-secondary disabled" th:if="${cur == last}" th:text="${total}" aria-current="page"></span>

        <!-- Next -->
        <a class="btn" th:if="${page.hasNext()}" th:href="@{''(page=${cur + 1})}">Next 〉</a>
        <span class="btn disabled" th:unless="${page.hasNext()}">Next 〉</span>
    </nav>
</div>

</html>